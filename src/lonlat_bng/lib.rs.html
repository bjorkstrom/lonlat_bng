<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="Source to the Rust file `src/lib.rs`.">
    <meta name="keywords" content="rust, rustlang, rust-lang">

    <title>lib.rs.html -- source</title>

    <link rel="stylesheet" type="text/css" href="../../normalize.css">
    <link rel="stylesheet" type="text/css" href="../../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../../main.css">
    

    
    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        <a href='../../lonlat_bng/index.html'><img src='https://raw.githubusercontent.com/urschrei/lonlat_bng/master/points.png' alt='logo' width='100'></a>
        
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content source"><pre class="line-numbers"><span id="1">  1</span>
<span id="2">  2</span>
<span id="3">  3</span>
<span id="4">  4</span>
<span id="5">  5</span>
<span id="6">  6</span>
<span id="7">  7</span>
<span id="8">  8</span>
<span id="9">  9</span>
<span id="10"> 10</span>
<span id="11"> 11</span>
<span id="12"> 12</span>
<span id="13"> 13</span>
<span id="14"> 14</span>
<span id="15"> 15</span>
<span id="16"> 16</span>
<span id="17"> 17</span>
<span id="18"> 18</span>
<span id="19"> 19</span>
<span id="20"> 20</span>
<span id="21"> 21</span>
<span id="22"> 22</span>
<span id="23"> 23</span>
<span id="24"> 24</span>
<span id="25"> 25</span>
<span id="26"> 26</span>
<span id="27"> 27</span>
<span id="28"> 28</span>
<span id="29"> 29</span>
<span id="30"> 30</span>
<span id="31"> 31</span>
<span id="32"> 32</span>
<span id="33"> 33</span>
<span id="34"> 34</span>
<span id="35"> 35</span>
<span id="36"> 36</span>
<span id="37"> 37</span>
<span id="38"> 38</span>
<span id="39"> 39</span>
<span id="40"> 40</span>
<span id="41"> 41</span>
<span id="42"> 42</span>
<span id="43"> 43</span>
<span id="44"> 44</span>
<span id="45"> 45</span>
<span id="46"> 46</span>
<span id="47"> 47</span>
<span id="48"> 48</span>
<span id="49"> 49</span>
<span id="50"> 50</span>
<span id="51"> 51</span>
<span id="52"> 52</span>
<span id="53"> 53</span>
<span id="54"> 54</span>
<span id="55"> 55</span>
<span id="56"> 56</span>
<span id="57"> 57</span>
<span id="58"> 58</span>
<span id="59"> 59</span>
<span id="60"> 60</span>
<span id="61"> 61</span>
<span id="62"> 62</span>
<span id="63"> 63</span>
<span id="64"> 64</span>
<span id="65"> 65</span>
<span id="66"> 66</span>
<span id="67"> 67</span>
<span id="68"> 68</span>
<span id="69"> 69</span>
<span id="70"> 70</span>
<span id="71"> 71</span>
<span id="72"> 72</span>
<span id="73"> 73</span>
<span id="74"> 74</span>
<span id="75"> 75</span>
<span id="76"> 76</span>
<span id="77"> 77</span>
<span id="78"> 78</span>
<span id="79"> 79</span>
<span id="80"> 80</span>
<span id="81"> 81</span>
<span id="82"> 82</span>
<span id="83"> 83</span>
<span id="84"> 84</span>
<span id="85"> 85</span>
<span id="86"> 86</span>
<span id="87"> 87</span>
<span id="88"> 88</span>
<span id="89"> 89</span>
<span id="90"> 90</span>
<span id="91"> 91</span>
<span id="92"> 92</span>
<span id="93"> 93</span>
<span id="94"> 94</span>
<span id="95"> 95</span>
<span id="96"> 96</span>
<span id="97"> 97</span>
<span id="98"> 98</span>
<span id="99"> 99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
<span id="276">276</span>
<span id="277">277</span>
<span id="278">278</span>
<span id="279">279</span>
<span id="280">280</span>
<span id="281">281</span>
<span id="282">282</span>
<span id="283">283</span>
<span id="284">284</span>
<span id="285">285</span>
<span id="286">286</span>
<span id="287">287</span>
<span id="288">288</span>
<span id="289">289</span>
<span id="290">290</span>
<span id="291">291</span>
<span id="292">292</span>
<span id="293">293</span>
<span id="294">294</span>
<span id="295">295</span>
<span id="296">296</span>
<span id="297">297</span>
<span id="298">298</span>
<span id="299">299</span>
<span id="300">300</span>
<span id="301">301</span>
<span id="302">302</span>
<span id="303">303</span>
<span id="304">304</span>
<span id="305">305</span>
<span id="306">306</span>
<span id="307">307</span>
<span id="308">308</span>
<span id="309">309</span>
<span id="310">310</span>
<span id="311">311</span>
<span id="312">312</span>
<span id="313">313</span>
<span id="314">314</span>
<span id="315">315</span>
<span id="316">316</span>
<span id="317">317</span>
<span id="318">318</span>
<span id="319">319</span>
<span id="320">320</span>
<span id="321">321</span>
<span id="322">322</span>
<span id="323">323</span>
<span id="324">324</span>
<span id="325">325</span>
<span id="326">326</span>
<span id="327">327</span>
<span id="328">328</span>
<span id="329">329</span>
<span id="330">330</span>
<span id="331">331</span>
<span id="332">332</span>
<span id="333">333</span>
<span id="334">334</span>
<span id="335">335</span>
<span id="336">336</span>
<span id="337">337</span>
<span id="338">338</span>
<span id="339">339</span>
<span id="340">340</span>
<span id="341">341</span>
<span id="342">342</span>
<span id="343">343</span>
<span id="344">344</span>
<span id="345">345</span>
<span id="346">346</span>
<span id="347">347</span>
<span id="348">348</span>
<span id="349">349</span>
<span id="350">350</span>
<span id="351">351</span>
<span id="352">352</span>
<span id="353">353</span>
<span id="354">354</span>
<span id="355">355</span>
<span id="356">356</span>
<span id="357">357</span>
<span id="358">358</span>
<span id="359">359</span>
<span id="360">360</span>
<span id="361">361</span>
<span id="362">362</span>
<span id="363">363</span>
<span id="364">364</span>
<span id="365">365</span>
<span id="366">366</span>
<span id="367">367</span>
<span id="368">368</span>
<span id="369">369</span>
<span id="370">370</span>
<span id="371">371</span>
<span id="372">372</span>
<span id="373">373</span>
<span id="374">374</span>
<span id="375">375</span>
<span id="376">376</span>
<span id="377">377</span>
<span id="378">378</span>
<span id="379">379</span>
<span id="380">380</span>
<span id="381">381</span>
<span id="382">382</span>
<span id="383">383</span>
<span id="384">384</span>
<span id="385">385</span>
<span id="386">386</span>
<span id="387">387</span>
<span id="388">388</span>
<span id="389">389</span>
<span id="390">390</span>
<span id="391">391</span>
<span id="392">392</span>
<span id="393">393</span>
<span id="394">394</span>
<span id="395">395</span>
<span id="396">396</span>
<span id="397">397</span>
<span id="398">398</span>
<span id="399">399</span>
<span id="400">400</span>
<span id="401">401</span>
<span id="402">402</span>
<span id="403">403</span>
<span id="404">404</span>
<span id="405">405</span>
<span id="406">406</span>
<span id="407">407</span>
<span id="408">408</span>
<span id="409">409</span>
<span id="410">410</span>
<span id="411">411</span>
<span id="412">412</span>
<span id="413">413</span>
<span id="414">414</span>
<span id="415">415</span>
<span id="416">416</span>
<span id="417">417</span>
<span id="418">418</span>
<span id="419">419</span>
<span id="420">420</span>
<span id="421">421</span>
<span id="422">422</span>
<span id="423">423</span>
<span id="424">424</span>
<span id="425">425</span>
<span id="426">426</span>
<span id="427">427</span>
<span id="428">428</span>
<span id="429">429</span>
<span id="430">430</span>
<span id="431">431</span>
<span id="432">432</span>
<span id="433">433</span>
<span id="434">434</span>
<span id="435">435</span>
<span id="436">436</span>
<span id="437">437</span>
<span id="438">438</span>
<span id="439">439</span>
<span id="440">440</span>
<span id="441">441</span>
<span id="442">442</span>
<span id="443">443</span>
<span id="444">444</span>
<span id="445">445</span>
<span id="446">446</span>
<span id="447">447</span>
<span id="448">448</span>
<span id="449">449</span>
<span id="450">450</span>
<span id="451">451</span>
<span id="452">452</span>
<span id="453">453</span>
<span id="454">454</span>
<span id="455">455</span>
<span id="456">456</span>
<span id="457">457</span>
<span id="458">458</span>
<span id="459">459</span>
<span id="460">460</span>
<span id="461">461</span>
<span id="462">462</span>
<span id="463">463</span>
<span id="464">464</span>
<span id="465">465</span>
<span id="466">466</span>
<span id="467">467</span>
<span id="468">468</span>
<span id="469">469</span>
<span id="470">470</span>
<span id="471">471</span>
<span id="472">472</span>
<span id="473">473</span>
<span id="474">474</span>
<span id="475">475</span>
<span id="476">476</span>
<span id="477">477</span>
<span id="478">478</span>
<span id="479">479</span>
<span id="480">480</span>
<span id="481">481</span>
<span id="482">482</span>
<span id="483">483</span>
<span id="484">484</span>
<span id="485">485</span>
<span id="486">486</span>
<span id="487">487</span>
<span id="488">488</span>
<span id="489">489</span>
<span id="490">490</span>
<span id="491">491</span>
<span id="492">492</span>
<span id="493">493</span>
<span id="494">494</span>
<span id="495">495</span>
<span id="496">496</span>
<span id="497">497</span>
<span id="498">498</span>
<span id="499">499</span>
<span id="500">500</span>
<span id="501">501</span>
<span id="502">502</span>
<span id="503">503</span>
<span id="504">504</span>
<span id="505">505</span>
<span id="506">506</span>
<span id="507">507</span>
<span id="508">508</span>
<span id="509">509</span>
<span id="510">510</span>
<span id="511">511</span>
<span id="512">512</span>
<span id="513">513</span>
<span id="514">514</span>
<span id="515">515</span>
<span id="516">516</span>
<span id="517">517</span>
<span id="518">518</span>
<span id="519">519</span>
<span id="520">520</span>
<span id="521">521</span>
<span id="522">522</span>
<span id="523">523</span>
<span id="524">524</span>
<span id="525">525</span>
<span id="526">526</span>
<span id="527">527</span>
<span id="528">528</span>
<span id="529">529</span>
<span id="530">530</span>
<span id="531">531</span>
<span id="532">532</span>
<span id="533">533</span>
<span id="534">534</span>
<span id="535">535</span>
<span id="536">536</span>
<span id="537">537</span>
<span id="538">538</span>
<span id="539">539</span>
<span id="540">540</span>
<span id="541">541</span>
<span id="542">542</span>
<span id="543">543</span>
</pre><pre class='rust '>
<span class='attribute'>#<span class='op'>!</span>[<span class='ident'>doc</span>(<span class='ident'>html_logo_url</span> <span class='op'>=</span> <span class='string'>&quot;https://raw.githubusercontent.com/urschrei/lonlat_bng/master/points.png&quot;</span>,
       <span class='ident'>html_root_url</span> <span class='op'>=</span> <span class='string'>&quot;https://urschrei.github.io/lonlat_bng/&quot;</span>)]</span>
<span class='doccomment'>//! The `lonlat_bng` crate provides functions that convert decimal (WGS84 / ETRS89) longitude</span>
<span class='doccomment'>//! and latitude coordinates into [British National Grid](https://en.wikipedia.org/wiki/Ordnance_Survey_National_Grid) coordinates, and vice versa.</span>
<span class='doccomment'>//! This library makes use of the [OSTN02](https://www.ordnancesurvey.co.uk/business-and-government/help-and-support/navigation-technology/os-net/surveying.html) transformations</span>
<span class='doccomment'>//!</span>
<span class='doccomment'>//! These functions transform input longitude and latitude coordinates to OSGB36 Eastings and Northings with high accuracy, and are suitable for use in surveying and construction. Please run your own tests, though.</span>
<span class='doccomment'>//! **Note that `lon`, `lat` coordinates outside the UK bounding box will be transformed to `(NAN, NAN)`, which cannot be mapped.**</span>
<span class='doccomment'>//!</span>
<span class='doccomment'>//! # Examples</span>
<span class='doccomment'>//!</span>
<span class='doccomment'>//! ```</span>
<span class='doccomment'>//! // Convert single Longitude, Latitude values to OSGB36 Eastings and Northings</span>
<span class='doccomment'>//! assert_eq!((651409.792, 313177.448), lonlat_bng::convert_osgb36(&amp;1.716073973, &amp;52.658007833).unwrap());</span>
<span class='doccomment'>//! ```</span>
<span class='doccomment'>//! ```</span>
<span class='doccomment'>//! // Convert vectors or slices using multi-threaded functions</span>
<span class='doccomment'>//! lonlat_bng::convert_to_osgb36_threaded_vec(vec![&amp;-0.32824866], vec![&amp;51.44533267]);</span>
<span class='doccomment'>//! lonlat_bng::convert_osgb36_to_lonlat_threaded_vec(vec![&amp;516276], vec![&amp;173141]);</span>
<span class='doccomment'>//! ```</span>
<span class='doccomment'>//! The crate also provides C-compatible wrapper functions which are intended for use with FFI.</span>
<span class='doccomment'>//!</span>
<span class='doccomment'>//! **An example FFI implementation using Python can be found at [Convertbng](https://github.com/urschrei/convertbng)**.</span>
<span class='doccomment'>//!</span>

<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>marker</span>::<span class='ident'>Send</span>;

<span class='kw'>extern</span> <span class='kw'>crate</span> <span class='ident'>rand</span>;
<span class='kw'>extern</span> <span class='kw'>crate</span> <span class='ident'>ostn15_phf</span>;
<span class='kw'>extern</span> <span class='kw'>crate</span> <span class='ident'>rayon</span>;
<span class='kw'>use</span> <span class='ident'>rayon</span>::<span class='ident'>prelude</span>::<span class='kw-2'>*</span>;

<span class='kw'>mod</span> <span class='ident'>conversions</span>;
<span class='kw'>pub</span> <span class='kw'>mod</span> <span class='ident'>utils</span>;
<span class='kw'>mod</span> <span class='ident'>ffi</span>;

<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>ffi</span>::<span class='ident'>Array</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>ffi</span>::<span class='ident'>drop_float_array</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>ffi</span>::<span class='ident'>convert_to_bng_threaded</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>ffi</span>::<span class='ident'>convert_to_lonlat_threaded</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>ffi</span>::<span class='ident'>convert_to_osgb36_threaded</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>ffi</span>::<span class='ident'>convert_to_etrs89_threaded</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>ffi</span>::<span class='ident'>convert_etrs89_to_osgb36_threaded</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>ffi</span>::<span class='ident'>convert_etrs89_to_ll_threaded</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>ffi</span>::<span class='ident'>convert_osgb36_to_ll_threaded</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>ffi</span>::<span class='ident'>convert_osgb36_to_etrs89_threaded</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>ffi</span>::<span class='ident'>convert_epsg3857_to_wgs84_threaded</span>;

<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>conversions</span>::<span class='ident'>convert_etrs89</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>conversions</span>::<span class='ident'>convert_osgb36</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>conversions</span>::<span class='ident'>convert_etrs89_to_osgb36</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>conversions</span>::<span class='ident'>convert_osgb36_to_etrs89</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>conversions</span>::<span class='ident'>convert_osgb36_to_ll</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>conversions</span>::<span class='ident'>convert_etrs89_to_ll</span>;
<span class='kw'>pub</span> <span class='kw'>use</span> <span class='ident'>conversions</span>::<span class='ident'>convert_epsg3857_to_wgs84</span>;

<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>f64</span>;
<span class='kw'>pub</span> <span class='kw'>const</span> <span class='ident'>NAN</span>: <span class='ident'>f64</span> <span class='op'>=</span> <span class='ident'>f64</span>::<span class='ident'>NAN</span>;

<span class='doccomment'>/// A threaded wrapper for [`lonlat_bng::convert_osgb36`](fn.convert_osgb36.html)</span>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>convert_to_bng_threaded_vec</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span>(<span class='ident'>longitudes</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>],
                                       <span class='ident'>latitudes</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>])
                                       <span class='op'>-&gt;</span> (<span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>], <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>]) {
    <span class='ident'>convert_vec_direct</span>(<span class='ident'>longitudes</span>, <span class='ident'>latitudes</span>, <span class='ident'>convert_osgb36</span>)
}

<span class='doccomment'>/// A threaded wrapper for [`lonlat_bng::convert_osgb36_to_ll`](fn.convert_osgb36_to_ll.html)</span>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>convert_to_lonlat_threaded_vec</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span>(<span class='ident'>eastings</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>],
                                          <span class='ident'>northings</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>])
                                          <span class='op'>-&gt;</span> (<span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>], <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>]) {
    <span class='ident'>convert_vec_direct</span>(<span class='ident'>eastings</span>, <span class='ident'>northings</span>, <span class='ident'>convert_osgb36_to_ll</span>)
}

<span class='doccomment'>/// A threaded wrapper for [`lonlat_bng::convert_etrs89`](fn.convert_etrs89.html)</span>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>convert_to_etrs89_threaded_vec</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span>(<span class='ident'>longitudes</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>],
                                          <span class='ident'>latitudes</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>])
                                          <span class='op'>-&gt;</span> (<span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>], <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>]) {
    <span class='ident'>convert_vec_direct</span>(<span class='ident'>longitudes</span>, <span class='ident'>latitudes</span>, <span class='ident'>convert_etrs89</span>)
}

<span class='doccomment'>/// A threaded wrapper for [`lonlat_bng::convert_osgb36`](fn.convert_osgb36.html)</span>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>convert_to_osgb36_threaded_vec</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span>(<span class='ident'>longitudes</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>],
                                          <span class='ident'>latitudes</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>])
                                          <span class='op'>-&gt;</span> (<span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>], <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>]) {
    <span class='ident'>convert_vec_direct</span>(<span class='ident'>longitudes</span>, <span class='ident'>latitudes</span>, <span class='ident'>convert_osgb36</span>)
}

<span class='doccomment'>/// A threaded wrapper for [`lonlat_bng::convert_etrs89_to_osgb36`](fn.convert_etrs89_to_osgb36.html)</span>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>convert_etrs89_to_osgb36_threaded_vec</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span>(<span class='ident'>eastings</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>],
                                                 <span class='ident'>northings</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>])
                                                 <span class='op'>-&gt;</span> (<span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>], <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>]) {
    <span class='ident'>convert_vec_direct</span>(<span class='ident'>eastings</span>, <span class='ident'>northings</span>, <span class='ident'>convert_etrs89_to_osgb36</span>)
}

<span class='doccomment'>/// A threaded wrapper for [`lonlat_bng::convert_etrs89_to_ll`](fn.convert_etrs8989_to_ll.html)</span>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>convert_etrs89_to_ll_threaded_vec</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span>(<span class='ident'>eastings</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>],
                                             <span class='ident'>northings</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>])
                                             <span class='op'>-&gt;</span> (<span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>], <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>]) {
    <span class='ident'>convert_vec_direct</span>(<span class='ident'>eastings</span>, <span class='ident'>northings</span>, <span class='ident'>convert_etrs89_to_ll</span>)
}

<span class='doccomment'>/// A threaded wrapper for [`lonlat_bng::convert_osgb36_to_etrs89`](fn.convert_osgb36_to_etrs89.html)</span>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>convert_osgb36_to_etrs89_threaded_vec</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span>(<span class='ident'>eastings</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>],
                                                 <span class='ident'>northings</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>])
                                                 <span class='op'>-&gt;</span> (<span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>], <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>]) {
    <span class='ident'>convert_vec_direct</span>(<span class='ident'>eastings</span>, <span class='ident'>northings</span>, <span class='ident'>convert_osgb36_to_etrs89</span>)
}

<span class='doccomment'>/// A threaded wrapper for [`lonlat_bng::convert_osgb36_to_ll`](fn.convert_osgb36_to_ll.html)</span>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>convert_osgb36_to_ll_threaded_vec</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span>(<span class='ident'>eastings</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>],
                                             <span class='ident'>northings</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>])
                                             <span class='op'>-&gt;</span> (<span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>], <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>]) {
    <span class='ident'>convert_vec_direct</span>(<span class='ident'>eastings</span>, <span class='ident'>northings</span>, <span class='ident'>convert_osgb36_to_ll</span>)
}

<span class='doccomment'>/// A threaded wrapper for [`lonlat_bng::convert_epsg3857_to_wgs84`](fn.convert_epsg3857_to_wgs84.html)</span>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>convert_epsg3857_to_wgs84_threaded_vec</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span>(<span class='ident'>x</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>],
                                                  <span class='ident'>y</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>])
                                                  <span class='op'>-&gt;</span> (<span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>], <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>]) {
    <span class='ident'>convert_vec_direct</span>(<span class='ident'>x</span>, <span class='ident'>y</span>, <span class='ident'>convert_epsg3857_to_wgs84</span>)
}

<span class='comment'>// Generic function which applies conversion functions to vector or slice chunks within threads</span>
<span class='comment'>// As opposed to the earlier convert_vec, we&#39;re directly modifying and returning the</span>
<span class='comment'>// inputs here, at the cost of having to use lifetime annotations</span>
<span class='kw'>fn</span> <span class='ident'>convert_vec_direct</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>F</span><span class='op'>&gt;</span>(<span class='ident'>ex</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>],
                             <span class='ident'>ny</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>],
                             <span class='ident'>func</span>: <span class='ident'>F</span>)
                             <span class='op'>-&gt;</span> (<span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>], <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> [<span class='ident'>f64</span>])
    <span class='kw'>where</span> <span class='ident'>F</span>: <span class='ident'>Fn</span>(<span class='kw-2'>&amp;</span><span class='ident'>f64</span>, <span class='kw-2'>&amp;</span><span class='ident'>f64</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Result</span><span class='op'>&lt;</span>(<span class='ident'>f64</span>, <span class='ident'>f64</span>), ()<span class='op'>&gt;</span> <span class='op'>+</span> <span class='ident'>Send</span> <span class='op'>+</span> <span class='ident'>Sync</span> <span class='op'>+</span> <span class='ident'>Copy</span>
{
    <span class='ident'>ex</span>.<span class='ident'>par_iter_mut</span>().<span class='ident'>weight_max</span>().<span class='ident'>zip</span>(<span class='ident'>ny</span>.<span class='ident'>par_iter_mut</span>().<span class='ident'>weight_max</span>()).<span class='ident'>for_each</span>(<span class='op'>|</span><span class='ident'>p</span><span class='op'>|</span> {
        <span class='kw'>match</span> <span class='ident'>func</span>(<span class='ident'>p</span>.<span class='number'>0</span>, <span class='ident'>p</span>.<span class='number'>1</span>) {
            <span class='comment'>// mutate values, or assign default error values</span>
            <span class='prelude-val'>Ok</span>(<span class='ident'>res</span>) <span class='op'>=&gt;</span> {
                <span class='kw-2'>*</span><span class='ident'>p</span>.<span class='number'>0</span> <span class='op'>=</span> <span class='ident'>res</span>.<span class='number'>0</span>;
                <span class='kw-2'>*</span><span class='ident'>p</span>.<span class='number'>1</span> <span class='op'>=</span> <span class='ident'>res</span>.<span class='number'>1</span>;
            }
            <span class='prelude-val'>Err</span>(_) <span class='op'>=&gt;</span> {
                <span class='kw-2'>*</span><span class='ident'>p</span>.<span class='number'>0</span> <span class='op'>=</span> <span class='ident'>NAN</span>;
                <span class='kw-2'>*</span><span class='ident'>p</span>.<span class='number'>1</span> <span class='op'>=</span> <span class='ident'>NAN</span>;
            }
        }
    });
    (<span class='ident'>ex</span>, <span class='ident'>ny</span>)
}

<span class='attribute'>#[<span class='ident'>cfg</span>(<span class='ident'>test</span>)]</span>
<span class='kw'>mod</span> <span class='ident'>tests</span> {
    <span class='kw'>use</span> <span class='kw'>super</span>::<span class='kw-2'>*</span>;
    <span class='kw'>use</span> <span class='ident'>conversions</span>::<span class='ident'>convert_bng</span>;
    <span class='kw'>use</span> <span class='kw'>super</span>::<span class='ident'>convert_vec_direct</span>;

    <span class='kw'>extern</span> <span class='kw'>crate</span> <span class='ident'>libc</span>;
    <span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>ptr</span>;

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='comment'>// Test Google/Bing Maps to WGS84 conversion</span>
    <span class='kw'>fn</span> <span class='ident'>test_epsg3857</span>() {
        <span class='kw'>let</span> <span class='ident'>x</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='op'>-</span><span class='number'>626172.1357121646</span>];
        <span class='kw'>let</span> <span class='ident'>y</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>6887893.4928337997</span>];
        <span class='kw'>let</span> <span class='ident'>x_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>x</span>);
        <span class='kw'>let</span> <span class='ident'>y_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>y</span>);
        <span class='kw'>let</span> (<span class='ident'>lon</span>, <span class='ident'>lat</span>) <span class='op'>=</span> <span class='ident'>convert_epsg3857_to_wgs84_threaded</span>(<span class='ident'>x_arr</span>, <span class='ident'>y_arr</span>);
        <span class='kw'>let</span> <span class='ident'>retval</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>lon</span>.<span class='ident'>into</span>();
        <span class='kw'>let</span> <span class='ident'>retval2</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>lat</span>.<span class='ident'>into</span>();
        <span class='kw'>let</span> <span class='ident'>expected</span> <span class='op'>=</span> (<span class='op'>-</span><span class='number'>5.625000000783013</span>, <span class='number'>52.48278022732355</span>);
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>expected</span>, (<span class='ident'>retval</span>[<span class='number'>0</span>], <span class='ident'>retval2</span>[<span class='number'>0</span>]));
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='comment'>// this test verifies that we aren&#39;t mangling memory inside our threads</span>
    <span class='kw'>fn</span> <span class='ident'>test_threading</span>() {
        <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>lon</span> <span class='op'>=</span> [<span class='op'>-</span><span class='number'>2.0183041005533306</span>,
                       <span class='number'>0.95511887434519682</span>,
                       <span class='number'>0.44975855518383501</span>,
                       <span class='op'>-</span><span class='number'>0.096813621191803811</span>,
                       <span class='op'>-</span><span class='number'>0.36807065656416427</span>,
                       <span class='number'>0.63486335458665621</span>];
        <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>lat</span> <span class='op'>=</span> [<span class='number'>54.589097162646141</span>,
                       <span class='number'>51.560873800587828</span>,
                       <span class='number'>50.431429161121699</span>,
                       <span class='number'>54.535021436247419</span>,
                       <span class='number'>50.839059313135706</span>,
                       <span class='number'>55.412189281234419</span>];
        <span class='ident'>convert_vec_direct</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>lon</span>, <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>lat</span>, <span class='ident'>convert_bng</span>);
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='number'>398915.033</span>, <span class='ident'>lon</span>[<span class='number'>0</span>]);
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='number'>521545.067</span>, <span class='ident'>lat</span>[<span class='number'>0</span>]);
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_os_etrs89_to_osgb36</span>() {
        <span class='comment'>// these are the values from the OSTN15 NTv2 download</span>
        <span class='comment'>// they exclude the two values which fall outside the bounding box</span>
        <span class='comment'>// several values differ by one digit in the third decimal place (mm)</span>
        <span class='kw'>let</span> <span class='ident'>etrs89_lons_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='comment'>// -6.29977752,</span>
                                                <span class='op'>-</span><span class='number'>5.2030461</span>,
                                                <span class='op'>-</span><span class='number'>4.108645636</span>,
                                                <span class='op'>-</span><span class='number'>1.297822772</span>,
                                                <span class='op'>-</span><span class='number'>1.450514337</span>,
                                                <span class='op'>-</span><span class='number'>3.551283492</span>,
                                                <span class='number'>1.444547304</span>,
                                                <span class='op'>-</span><span class='number'>2.544076183</span>,
                                                <span class='op'>-</span><span class='number'>0.119925572</span>,
                                                <span class='op'>-</span><span class='number'>4.30852477</span>,
                                                <span class='number'>0.89724327</span>,
                                                <span class='op'>-</span><span class='number'>2.154586144</span>,
                                                <span class='op'>-</span><span class='number'>0.91248957</span>,
                                                <span class='number'>0.401535471</span>,
                                                <span class='op'>-</span><span class='number'>1.197476559</span>,
                                                <span class='op'>-</span><span class='number'>2.640493208</span>,
                                                <span class='op'>-</span><span class='number'>4.289180698</span>,
                                                <span class='op'>-</span><span class='number'>4.289177929</span>,
                                                <span class='op'>-</span><span class='number'>3.040454907</span>,
                                                <span class='op'>-</span><span class='number'>1.663791682</span>,
                                                <span class='op'>-</span><span class='number'>4.634521682</span>,
                                                <span class='op'>-</span><span class='number'>0.077731332</span>,
                                                <span class='op'>-</span><span class='number'>4.388491181</span>,
                                                <span class='op'>-</span><span class='number'>2.938277411</span>,
                                                <span class='op'>-</span><span class='number'>1.616576852</span>,
                                                <span class='op'>-</span><span class='number'>4.296490163</span>,
                                                <span class='op'>-</span><span class='number'>3.294792193</span>,
                                                <span class='op'>-</span><span class='number'>5.828366919</span>,
                                                <span class='op'>-</span><span class='number'>2.048560307</span>,
                                                <span class='comment'>// -4.219263986,</span>
                                                <span class='comment'>// -8.578544561,</span>
                                                <span class='comment'>// -7.592555606,</span>
                                                <span class='op'>-</span><span class='number'>6.260914555</span>,
                                                <span class='op'>-</span><span class='number'>3.726310221</span>,
                                                <span class='op'>-</span><span class='number'>3.214540011</span>,
                                                <span class='op'>-</span><span class='number'>4.417576746</span>,
                                                <span class='op'>-</span><span class='number'>5.827993398</span>,
                                                <span class='op'>-</span><span class='number'>1.625169661</span>,
                                                <span class='op'>-</span><span class='number'>1.274869104</span>,
                                                <span class='op'>-</span><span class='number'>2.073828228</span>];
        <span class='kw'>let</span> <span class='ident'>etrs89_lats_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='comment'>// 49.92226394,</span>
                                                <span class='number'>49.96006138</span>,
                                                <span class='number'>50.43885826</span>,
                                                <span class='number'>50.57563665</span>,
                                                <span class='number'>50.93127938</span>,
                                                <span class='number'>51.4007822</span>,
                                                <span class='number'>51.37447026</span>,
                                                <span class='number'>51.42754743</span>,
                                                <span class='number'>51.48936565</span>,
                                                <span class='number'>51.85890896</span>,
                                                <span class='number'>51.89436637</span>,
                                                <span class='number'>52.25529382</span>,
                                                <span class='number'>52.25160951</span>,
                                                <span class='number'>52.75136687</span>,
                                                <span class='number'>52.96219109</span>,
                                                <span class='number'>53.3448028</span>,
                                                <span class='number'>53.41628516</span>,
                                                <span class='number'>53.41630925</span>,
                                                <span class='number'>53.77911026</span>,
                                                <span class='number'>53.8002152</span>,
                                                <span class='number'>54.08666318</span>,
                                                <span class='number'>54.11685144</span>,
                                                <span class='number'>54.32919541</span>,
                                                <span class='number'>54.8954234</span>,
                                                <span class='number'>54.97912274</span>,
                                                <span class='number'>55.85399953</span>,
                                                <span class='number'>55.92478266</span>,
                                                <span class='number'>57.00606696</span>,
                                                <span class='number'>57.13902519</span>,
                                                <span class='comment'>// 57.48625001,</span>
                                                <span class='comment'>// 57.81351838,</span>
                                                <span class='comment'>// 58.21262247,</span>
                                                <span class='number'>58.51560361</span>,
                                                <span class='number'>58.58120461</span>,
                                                <span class='number'>59.03743871</span>,
                                                <span class='number'>59.09335035</span>,
                                                <span class='number'>59.09671617</span>,
                                                <span class='number'>59.53470794</span>,
                                                <span class='number'>59.85409914</span>,
                                                <span class='number'>60.13308092</span>];

        <span class='kw'>let</span> <span class='ident'>osgb36_e_vec</span> <span class='op'>=</span> [<span class='comment'>// 91492.146,</span>
                            <span class='number'>170370.718</span>,
                            <span class='number'>250359.811</span>,
                            <span class='number'>449816.371</span>,
                            <span class='number'>438710.92</span>,
                            <span class='number'>292184.87</span>,
                            <span class='number'>639821.835</span>,
                            <span class='number'>362269.991</span>,
                            <span class='number'>530624.974</span>,
                            <span class='number'>241124.584</span>,
                            <span class='number'>599445.59</span>,
                            <span class='number'>389544.19</span>,
                            <span class='number'>474335.969</span>,
                            <span class='number'>562180.547</span>,
                            <span class='number'>454002.834</span>,
                            <span class='number'>357455.843</span>,
                            <span class='number'>247958.971</span>,
                            <span class='number'>247959.241</span>,
                            <span class='number'>331534.564</span>,
                            <span class='number'>422242.186</span>,
                            <span class='number'>227778.33</span>,
                            <span class='number'>525745.67</span>,
                            <span class='number'>244780.636</span>,
                            <span class='number'>339921.145</span>,
                            <span class='number'>424639.355</span>,
                            <span class='number'>256340.925</span>,
                            <span class='number'>319188.434</span>,
                            <span class='number'>167634.202</span>,
                            <span class='number'>397160.491</span>,
                            <span class='comment'>// 267056.768,</span>
                            <span class='comment'>// 9587.909,</span>
                            <span class='comment'>// 71713.132,</span>
                            <span class='number'>151968.652</span>,
                            <span class='number'>299721.891</span>,
                            <span class='number'>330398.323</span>,
                            <span class='number'>261596.778</span>,
                            <span class='number'>180862.461</span>,
                            <span class='number'>421300.525</span>,
                            <span class='number'>440725.073</span>,
                            <span class='number'>395999.668</span>];
        <span class='kw'>let</span> <span class='ident'>osgb36_n_vec</span> <span class='op'>=</span> [<span class='comment'>// 11318.804,</span>
                            <span class='number'>11572.405</span>,
                            <span class='number'>62016.569</span>,
                            <span class='number'>75335.861</span>,
                            <span class='number'>114792.25</span>,
                            <span class='number'>168003.465</span>,
                            <span class='number'>169565.858</span>,
                            <span class='number'>169978.69</span>,
                            <span class='number'>178388.464</span>,
                            <span class='number'>220332.641</span>,
                            <span class='number'>225722.826</span>,
                            <span class='number'>261912.153</span>,
                            <span class='number'>262047.755</span>,
                            <span class='number'>319784.995</span>,
                            <span class='number'>340834.943</span>,
                            <span class='number'>383290.436</span>,
                            <span class='number'>393492.909</span>,
                            <span class='number'>393495.583</span>,
                            <span class='number'>431920.794</span>,
                            <span class='number'>433818.701</span>,
                            <span class='number'>468847.388</span>,
                            <span class='number'>470703.214</span>,
                            <span class='number'>495254.887</span>,
                            <span class='number'>556034.761</span>,
                            <span class='number'>565012.703</span>,
                            <span class='number'>664697.269</span>,
                            <span class='number'>670947.534</span>,
                            <span class='number'>797067.144</span>,
                            <span class='number'>805349.736</span>,
                            <span class='comment'>// 846176.972,</span>
                            <span class='comment'>// 899448.996,</span>
                            <span class='comment'>// 938516.404,</span>
                            <span class='number'>966483.78</span>,
                            <span class='number'>967202.992</span>,
                            <span class='number'>1017347.016</span>,
                            <span class='number'>1025447.602</span>,
                            <span class='number'>1029604.114</span>,
                            <span class='number'>1072147.239</span>,
                            <span class='number'>1107878.448</span>,
                            <span class='number'>1138728.951</span>];
        <span class='kw'>let</span> <span class='ident'>e_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>etrs89_lons_vec</span>);
        <span class='kw'>let</span> <span class='ident'>n_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>etrs89_lats_vec</span>);
        <span class='kw'>let</span> (<span class='ident'>osgb36_eastings</span>, <span class='ident'>osgb36_northings</span>) <span class='op'>=</span> <span class='ident'>convert_to_bng_threaded</span>(<span class='ident'>e_arr</span>, <span class='ident'>n_arr</span>);
        <span class='kw'>let</span> <span class='ident'>retval</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>osgb36_eastings</span>.<span class='ident'>into</span>();
        <span class='kw'>let</span> <span class='ident'>retval2</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>osgb36_northings</span>.<span class='ident'>into</span>();
        <span class='comment'>// We&#39;re using absolute error margins here, but it should be OK</span>
        <span class='comment'>// test eastings</span>
        <span class='kw'>for</span> (<span class='ident'>expect</span>, <span class='ident'>result</span>) <span class='kw'>in</span> <span class='ident'>osgb36_e_vec</span>.<span class='ident'>iter</span>().<span class='ident'>zip</span>(<span class='ident'>retval</span>.<span class='ident'>iter</span>()) {
            <span class='macro'>assert</span><span class='macro'>!</span>(((<span class='ident'>expect</span> <span class='op'>-</span> <span class='ident'>result</span>) <span class='op'>/</span> <span class='ident'>result</span>).<span class='ident'>abs</span>() <span class='op'>&lt;</span> <span class='number'>0.0000001</span>)
        }
        <span class='comment'>// test northings</span>
        <span class='kw'>for</span> (<span class='ident'>expect</span>, <span class='ident'>result</span>) <span class='kw'>in</span> <span class='ident'>osgb36_n_vec</span>.<span class='ident'>iter</span>().<span class='ident'>zip</span>(<span class='ident'>retval2</span>.<span class='ident'>iter</span>()) {
            <span class='macro'>assert</span><span class='macro'>!</span>(((<span class='ident'>expect</span> <span class='op'>-</span> <span class='ident'>result</span>) <span class='op'>/</span> <span class='ident'>result</span>).<span class='ident'>abs</span>() <span class='op'>&lt;</span> <span class='number'>0.0000001</span>)
        }
        <span class='comment'>// This will fail because 11 results differ by .001 (so 1 mm)</span>
        <span class='comment'>// assert_eq!(osgb36_e_vec, retval);</span>
        <span class='comment'>// assert_eq!(osgb36_n_vec, retval2);</span>
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='attribute'>#[<span class='ident'>should_panic</span>]</span>
    <span class='comment'>// This should panic because the OSTN02 test suite specifies it as outside the polygon: Outside#1</span>
    <span class='comment'>// Lon: 4, 51, 3.503091</span>
    <span class='comment'>// Lat: 53,20, 49.312599</span>
    <span class='kw'>fn</span> <span class='ident'>test_ostn_invalid_outside_1</span>() {
        <span class='kw'>let</span> _ <span class='op'>=</span> <span class='ident'>convert_osgb36</span>(<span class='kw-2'>&amp;</span><span class='number'>4.850973</span>, <span class='kw-2'>&amp;</span><span class='number'>53.347031</span>).<span class='ident'>unwrap</span>();
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='attribute'>#[<span class='ident'>should_panic</span>]</span>
    <span class='comment'>// This should panic because the OSTN02 test suite specifies it as outside the polygon: Outside#2</span>
    <span class='comment'>// Lon: 2, 22, 31.048596</span>
    <span class='comment'>// Lat: 56, 10, 31.115299</span>
    <span class='kw'>fn</span> <span class='ident'>test_ostn_invalid_outside_2</span>() {
        <span class='kw'>let</span> _ <span class='op'>=</span> <span class='ident'>convert_osgb36</span>(<span class='kw-2'>&amp;</span><span class='number'>2.375291</span>, <span class='kw-2'>&amp;</span><span class='number'>56.17531</span>).<span class='ident'>unwrap</span>();

    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_threaded_bng_conversion_single</span>() {
        <span class='kw'>let</span> <span class='ident'>lon_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>1.716073973</span>];
        <span class='kw'>let</span> <span class='ident'>lat_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>52.65800783</span>];
        <span class='kw'>let</span> <span class='ident'>lon_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>lon_vec</span>);
        <span class='kw'>let</span> <span class='ident'>lat_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>lat_vec</span>);
        <span class='kw'>let</span> (<span class='ident'>eastings</span>, _) <span class='op'>=</span> <span class='ident'>convert_to_bng_threaded</span>(<span class='ident'>lon_arr</span>, <span class='ident'>lat_arr</span>);
        <span class='kw'>let</span> <span class='ident'>retval</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>eastings</span>.<span class='ident'>into</span>();
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='number'>651409.804</span>, <span class='ident'>retval</span>[<span class='number'>0</span>]);
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_threaded_lonlat_conversion_single</span>() {
        <span class='comment'>// Caister Water Tower OSGB36 coords</span>
        <span class='kw'>let</span> <span class='ident'>easting_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>651409.804</span>];
        <span class='kw'>let</span> <span class='ident'>northing_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>313177.450</span>];


        <span class='kw'>let</span> <span class='ident'>easting_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>easting_vec</span>);
        <span class='kw'>let</span> <span class='ident'>northing_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>northing_vec</span>);
        <span class='kw'>let</span> (<span class='ident'>lons</span>, _) <span class='op'>=</span> <span class='ident'>convert_to_lonlat_threaded</span>(<span class='ident'>easting_arr</span>, <span class='ident'>northing_arr</span>);
        <span class='kw'>let</span> <span class='ident'>retval</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>lons</span>.<span class='ident'>into</span>();
        <span class='comment'>// We shouldn&#39;t really be using error margins, but it should be OK because</span>
        <span class='comment'>// neither number is zero, or very close to, and on opposite sides of zero</span>
        <span class='comment'>// http://floating-point-gui.de/errors/comparison/</span>
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='number'>1.71607397</span>, <span class='ident'>retval</span>[<span class='number'>0</span>]);
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_threaded_osgb36_conversion_single</span>() {
        <span class='kw'>let</span> <span class='ident'>lon_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>1.716073973</span>];
        <span class='kw'>let</span> <span class='ident'>lat_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>52.65800783</span>];
        <span class='kw'>let</span> <span class='ident'>lon_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>lon_vec</span>);
        <span class='kw'>let</span> <span class='ident'>lat_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>lat_vec</span>);
        <span class='kw'>let</span> (<span class='ident'>eastings</span>, _) <span class='op'>=</span> <span class='ident'>convert_to_osgb36_threaded</span>(<span class='ident'>lon_arr</span>, <span class='ident'>lat_arr</span>);
        <span class='kw'>let</span> <span class='ident'>retval</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>eastings</span>.<span class='ident'>into</span>();
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='number'>651409.804</span>, <span class='ident'>retval</span>[<span class='number'>0</span>]);
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_threaded_etrs89_to_osgb36_conversion_single</span>() {
        <span class='kw'>let</span> <span class='ident'>e_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>651307.003</span>];
        <span class='kw'>let</span> <span class='ident'>n_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>313255.686</span>];
        <span class='kw'>let</span> <span class='ident'>e_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>e_vec</span>);
        <span class='kw'>let</span> <span class='ident'>n_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>n_vec</span>);
        <span class='kw'>let</span> (<span class='ident'>eastings</span>, _) <span class='op'>=</span> <span class='ident'>convert_etrs89_to_osgb36_threaded</span>(<span class='ident'>e_arr</span>, <span class='ident'>n_arr</span>);
        <span class='kw'>let</span> <span class='ident'>retval</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>eastings</span>.<span class='ident'>into</span>();
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='number'>651409.804</span>, <span class='ident'>retval</span>[<span class='number'>0</span>]);
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_threaded_osgb36_to_etrs89_conversion_single</span>() {
        <span class='comment'>// Caister Water Tower OSGB36, see p21</span>
        <span class='kw'>let</span> <span class='ident'>e_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>651409.804</span>];
        <span class='kw'>let</span> <span class='ident'>n_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>313177.450</span>];
        <span class='kw'>let</span> <span class='ident'>e_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>e_vec</span>);
        <span class='kw'>let</span> <span class='ident'>n_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>n_vec</span>);
        <span class='kw'>let</span> (<span class='ident'>eastings</span>, _) <span class='op'>=</span> <span class='ident'>convert_osgb36_to_etrs89_threaded</span>(<span class='ident'>e_arr</span>, <span class='ident'>n_arr</span>);
        <span class='kw'>let</span> <span class='ident'>retval</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>eastings</span>.<span class='ident'>into</span>();
        <span class='comment'>// Caister Water Tower ETRS89, see p20</span>
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='number'>651307.003</span>, <span class='ident'>retval</span>[<span class='number'>0</span>]);
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_threaded_etrs89_conversion_single</span>() {
        <span class='kw'>let</span> <span class='ident'>lon_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>1.716073973</span>];
        <span class='kw'>let</span> <span class='ident'>lat_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>52.65800783</span>];
        <span class='kw'>let</span> <span class='ident'>lon_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>lon_vec</span>);
        <span class='kw'>let</span> <span class='ident'>lat_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>lat_vec</span>);
        <span class='kw'>let</span> (<span class='ident'>eastings</span>, _) <span class='op'>=</span> <span class='ident'>convert_to_etrs89_threaded</span>(<span class='ident'>lon_arr</span>, <span class='ident'>lat_arr</span>);
        <span class='kw'>let</span> <span class='ident'>retval</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>eastings</span>.<span class='ident'>into</span>();
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='number'>651307.003</span>, <span class='ident'>retval</span>[<span class='number'>0</span>]);
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_threaded_etrs89_to_ll_conversion_single</span>() {
        <span class='kw'>let</span> <span class='ident'>e_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>651307.003</span>];
        <span class='kw'>let</span> <span class='ident'>n_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>313255.686</span>];
        <span class='kw'>let</span> <span class='ident'>e_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>e_vec</span>);
        <span class='kw'>let</span> <span class='ident'>n_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>n_vec</span>);
        <span class='kw'>let</span> (<span class='ident'>lon</span>, <span class='ident'>lat</span>) <span class='op'>=</span> <span class='ident'>convert_etrs89_to_ll_threaded</span>(<span class='ident'>e_arr</span>, <span class='ident'>n_arr</span>);
        <span class='kw'>let</span> <span class='ident'>retval</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>lon</span>.<span class='ident'>into</span>();
        <span class='kw'>let</span> <span class='ident'>retval2</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>lat</span>.<span class='ident'>into</span>();
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='number'>1.71607397</span>, <span class='ident'>retval</span>[<span class='number'>0</span>]);
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='number'>52.65800783</span>, <span class='ident'>retval2</span>[<span class='number'>0</span>]);

    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_threaded_osgb36_to_ll_conversion_single</span>() {
        <span class='comment'>// Caister Water Tower</span>
        <span class='kw'>let</span> <span class='ident'>e_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>651409.804</span>];
        <span class='kw'>let</span> <span class='ident'>n_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>313177.450</span>];

        <span class='kw'>let</span> <span class='ident'>e_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>e_vec</span>);
        <span class='kw'>let</span> <span class='ident'>n_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>n_vec</span>);
        <span class='kw'>let</span> (<span class='ident'>lon</span>, <span class='ident'>lat</span>) <span class='op'>=</span> <span class='ident'>convert_osgb36_to_ll_threaded</span>(<span class='ident'>e_arr</span>, <span class='ident'>n_arr</span>);
        <span class='kw'>let</span> <span class='ident'>retval</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>lon</span>.<span class='ident'>into</span>();
        <span class='kw'>let</span> <span class='ident'>retval2</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>lat</span>.<span class='ident'>into</span>();
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='number'>1.71607397</span>, <span class='ident'>retval</span>[<span class='number'>0</span>]);
        <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='number'>52.65800783</span>, <span class='ident'>retval2</span>[<span class='number'>0</span>]);

    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_drop_float_array</span>() {
        <span class='kw'>let</span> <span class='ident'>lon_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='op'>-</span><span class='number'>2.0183041005533306</span>];
        <span class='kw'>let</span> <span class='ident'>lat_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>54.589097162646141</span>];
        <span class='kw'>let</span> <span class='ident'>lon_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>lon_vec</span>);
        <span class='kw'>let</span> <span class='ident'>lat_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>lat_vec</span>);
        <span class='kw'>let</span> (<span class='ident'>eastings</span>, <span class='ident'>northings</span>) <span class='op'>=</span> <span class='ident'>convert_to_bng_threaded</span>(<span class='ident'>lon_arr</span>, <span class='ident'>lat_arr</span>);
        <span class='ident'>drop_float_array</span>(<span class='ident'>eastings</span>, <span class='ident'>northings</span>);
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_empty_lon_array</span>() {
        <span class='kw'>let</span> <span class='ident'>lon_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [];
        <span class='kw'>let</span> <span class='ident'>lat_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [];
        <span class='kw'>let</span> <span class='ident'>lon_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>lon_vec</span>);
        <span class='kw'>let</span> <span class='ident'>lat_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>lat_vec</span>);
        <span class='kw'>let</span> (<span class='kw-2'>mut</span> <span class='ident'>eastings</span>, <span class='ident'>northings</span>) <span class='op'>=</span> <span class='ident'>convert_to_bng_threaded</span>(<span class='ident'>lon_arr</span>, <span class='ident'>lat_arr</span>);
        <span class='ident'>eastings</span>.<span class='ident'>data</span> <span class='op'>=</span> <span class='ident'>ptr</span>::<span class='ident'>null</span>();
        <span class='ident'>drop_float_array</span>(<span class='ident'>eastings</span>, <span class='ident'>northings</span>);
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_empty_lat_array</span>() {
        <span class='kw'>let</span> <span class='ident'>lon_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [];
        <span class='kw'>let</span> <span class='ident'>lat_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [];
        <span class='kw'>let</span> <span class='ident'>lon_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>lon_vec</span>);
        <span class='kw'>let</span> <span class='ident'>lat_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>lat_vec</span>);
        <span class='kw'>let</span> (<span class='ident'>eastings</span>, <span class='kw-2'>mut</span> <span class='ident'>northings</span>) <span class='op'>=</span> <span class='ident'>convert_to_bng_threaded</span>(<span class='ident'>lon_arr</span>, <span class='ident'>lat_arr</span>);
        <span class='ident'>northings</span>.<span class='ident'>data</span> <span class='op'>=</span> <span class='ident'>ptr</span>::<span class='ident'>null</span>();
        <span class='ident'>drop_float_array</span>(<span class='ident'>eastings</span>, <span class='ident'>northings</span>);
    }

    <span class='attribute'>#[<span class='ident'>test</span>]</span>
    <span class='kw'>fn</span> <span class='ident'>test_bad_threaded_conversion</span>() {
        <span class='comment'>// above maximum longitude</span>
        <span class='kw'>let</span> <span class='ident'>lon_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>1.85</span>];
        <span class='kw'>let</span> <span class='ident'>lat_vec</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='number'>55.811741</span>];
        <span class='kw'>let</span> <span class='ident'>lon_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>lon_vec</span>);
        <span class='kw'>let</span> <span class='ident'>lat_arr</span> <span class='op'>=</span> <span class='ident'>Array</span>::<span class='ident'>from</span>(<span class='ident'>lat_vec</span>);
        <span class='kw'>let</span> (<span class='ident'>eastings</span>, _) <span class='op'>=</span> <span class='ident'>convert_to_bng_threaded</span>(<span class='ident'>lon_arr</span>, <span class='ident'>lat_arr</span>);
        <span class='kw'>let</span> <span class='ident'>retval</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> [<span class='ident'>f64</span>] <span class='op'>=</span> <span class='ident'>eastings</span>.<span class='ident'>into</span>();
        <span class='macro'>assert</span><span class='macro'>!</span>(<span class='ident'>retval</span>[<span class='number'>0</span>].<span class='ident'>is_nan</span>());
    }

}
</pre>
</section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../../";
        window.currentCrate = "lonlat_bng";
    </script>
    <script src="../../jquery.js"></script>
    <script src="../../main.js"></script>
    <script defer src="../../search-index.js"></script>
</body>
</html>